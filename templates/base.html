<!doctype html>
<html lang="en">
    <head>
        {% include "_head.html" %}
        {% block extra_head %}
        {% endblock %}
    </head>

    <body>
        <header>
            <nav class="navbar">
                <div class="nav-container">
                    <div class="nav-logo">
                        <a href="{{ url_for('index') }}"> <i class="fas fa-calendar-alt"></i> Campus Scheduler </a>
                    </div>

                    <button class="nav-toggle" aria-label="toggle navigation">
                        <i class="fas fa-bars"></i>
                    </button>

                    {% import "macros/navigation.html" as nav %}
                    <ul class="nav-menu">
                        {{ nav.link('Home',    'index',   'fas fa-home') }}

                        {% if not session.get('username') %}
                            {{ nav.link('About',   'about',   'fas fa-info-circle') }}
                            {{ nav.link('Privacy', 'privacy', 'fas fa-user-shield') }}
                            {{ nav.link('Login',    'auth.login',    'fas fa-sign-in-alt') }}
                            {{ nav.link('Register', 'auth.register', 'fas fa-user-plus') }}
                        {% else %}
                            {% set role = session.get('role_name','') %}
                            {% set is_admin = role in ['Admin','Manager'] %}

                            {% if is_admin %}
                                {{ nav.link('Projects', 'projects', 'fas fa-project-diagram') }}
                            {% endif %}
                            {{ nav.link('Tasks',  'tasks',  'fas fa-tasks') }}
                            {{ nav.link('Events', 'events', 'fas fa-calendar') }}
                            {% if is_admin %}
                                {{ nav.link('Costs', 'analysis', 'fas fa-dollar-sign') }}
                            {% endif %}
                            <li class="nav-item profile-dropdown" id="profile-dropdown">
                                <a href="#" class="nav-link profile-trigger">
                                    <img
                                        src="{{ session.get('profile_pic', url_for('static', filename='images/placeholder.jpg')) }}"
                                        alt="Profile Picture"
                                        class="profile-pic"
                                    />
                                    <span class="profile-name"
                                        >{{ session.get('name', session.get('username', 'User')) }}</span
                                    >
                                    <i class="fas fa-caret-down"></i>
                                </a>
                                <div class="dropdown-content">
                                    <div class="profile-info">
                                        <img
                                            src="{{ session.get('profile_pic', url_for('static', filename='images/placeholder.jpg')) }}"
                                            alt="Profile Picture"
                                            class="profile-pic-large"
                                        />
                                        <div class="profile-text">
                                            <span class="profile-username"
                                                >{{ session.get('username', 'Profile') }}</span
                                            >
                                            <span class="profile-username">{{ session.get('role_name', 'User') }}</span>
                                        </div>
                                    </div>
                                    <hr />
                                    <a href="{{ url_for('auth.logout') }}" class="dropdown-link">Logout</a>
                                </div>
                            </li>
                        {% endif %}
                    </ul>
                </div>
            </nav>
        </header>

        <main class="container">{% block content %}{% endblock %}</main>

        <footer>
            <div class="footer-container">Â© {{ (now().year) }} Campus Scheduler. All rights reserved.</div>
        </footer>

        {% block scripts %}
            <script src="{{ url_for('static', filename='js/navbar.js') }}" defer></script>
        {% endblock %}
    </body>
</html>
